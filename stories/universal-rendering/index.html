



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Angular CLI中文文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.0">
    
    
      
        <title>通用渲染 - 角令文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.78aab2dc.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#angular-universal-integration" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="角令文档" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                角令文档
              </span>
              <span class="md-header-nav__topic">
                通用渲染
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/wohugb/wangdake" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/wangdake
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="概述" class="md-tabs__link">
        概述
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../cli/" title="命令" class="md-tabs__link">
          命令
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../generate/" title="ng generate" class="md-tabs__link">
          ng generate
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../include/angular-flex/" title="引入" class="md-tabs__link">
          引入
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../configure-hmr/" title="配置" class="md-tabs__link md-tabs__link--active">
          配置
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="stories" class="md-tabs__link">
          stories
        </a>
      
    </li>
  

      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    角令文档
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wohugb/wangdake" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/wangdake
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="概述" class="md-nav__link">
      概述
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      命令
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        命令
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/build/" title="ng build" class="md-nav__link">
      ng build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/config/" title="ng config" class="md-nav__link">
      ng config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/doc/" title="ng doc" class="md-nav__link">
      ng doc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/e2e/" title="ng e2e" class="md-nav__link">
      ng e2e
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/eject/" title="ng eject" class="md-nav__link">
      ng eject
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/lint/" title="ng lint" class="md-nav__link">
      ng lint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/new/" title="ng new" class="md-nav__link">
      ng new
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/serve/" title="ng serve" class="md-nav__link">
      ng serve
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/test/" title="ng test" class="md-nav__link">
      ng test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/update/" title="ng update" class="md-nav__link">
      ng update
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ng generate
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ng generate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/" title="ng generate" class="md-nav__link">
      ng generate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/class/" title="ng generate class" class="md-nav__link">
      ng generate class
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/component/" title="ng generate component" class="md-nav__link">
      ng generate component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/directive/" title="ng generate directive" class="md-nav__link">
      ng generate directive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/enum/" title="ng generate enum" class="md-nav__link">
      ng generate enum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/guard/" title="ng generate guard" class="md-nav__link">
      ng generate guard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/interface/" title="ng generate interface" class="md-nav__link">
      ng generate interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/module/" title="ng generate module" class="md-nav__link">
      ng generate module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/pipe/" title="ng generate pipe" class="md-nav__link">
      ng generate pipe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../generate/service/" title="ng generate service" class="md-nav__link">
      ng generate service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      引入
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        引入
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../include/angular-flex/" title="引入角曲" class="md-nav__link">
      引入角曲
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../include/angular-material/" title="引入角料" class="md-nav__link">
      引入角料
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../include/angularfire/" title="引入角火" class="md-nav__link">
      引入角火
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../include/bootstrap/" title="引入bootstrap" class="md-nav__link">
      引入bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../include/font-awesome/" title="引入font awesome" class="md-nav__link">
      引入font awesome
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      配置
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        配置
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../configure-hmr/" title="配置hmr" class="md-nav__link">
      配置hmr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-environments/" title="应用环境" class="md-nav__link">
      应用环境
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-environments/" title="资产配置" class="md-nav__link">
      资产配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../global/lib/" title="全局库" class="md-nav__link">
      全局库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../global/scripts/" title="全局脚本" class="md-nav__link">
      全局脚本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../global/styles/" title="全局风格" class="md-nav__link">
      全局风格
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../css-preprocessors/" title="css预处理器" class="md-nav__link">
      css预处理器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../third-party-lib/" title="第三方库" class="md-nav__link">
      第三方库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../autocompletion/" title="自动完成" class="md-nav__link">
      自动完成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../autoprefixer/" title="autoprefixer" class="md-nav__link">
      autoprefixer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../budgets/" title="budgets" class="md-nav__link">
      budgets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../continuous-integration/" title="持续集成" class="md-nav__link">
      持续集成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../github-pages/" title="github页面" class="md-nav__link">
      github页面
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        通用渲染
      </label>
    
    <a href="./" title="通用渲染" class="md-nav__link md-nav__link--active">
      通用渲染
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-cli-integration" title="Example CLI Integration:" class="md-nav__link">
    Example CLI Integration:
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multiple-apps/" title="多应用" class="md-nav__link">
      多应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proxy/" title="代理" class="md-nav__link">
      代理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../routing/" title="路由" class="md-nav__link">
      路由
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../using-corporate-proxy/" title="使用公司代理" class="md-nav__link">
      使用公司代理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../internationalization/" title="国际化" class="md-nav__link">
      国际化
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      stories
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        stories
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="故事" class="md-nav__link">
      故事
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.0-update/" title="1.0更新" class="md-nav__link">
      1.0更新
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rc-update/" title="rc更新" class="md-nav__link">
      rc更新
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rc.0-update/" title="rc.0更新" class="md-nav__link">
      rc.0更新
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../code-coverage/" title="代码覆盖率" class="md-nav__link">
      代码覆盖率
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disk-serve/" title="磁盘服务" class="md-nav__link">
      磁盘服务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linked-library/" title="链接库" class="md-nav__link">
      链接库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../moving-into-the-cli/" title="移入CLI" class="md-nav__link">
      移入CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../moving-out-of-the-cli/" title="移出CLI" class="md-nav__link">
      移出CLI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../DevHandbook/" title="DevHandbook" class="md-nav__link">
      DevHandbook
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LifeOfAFeature/" title="LifeOfAFeature" class="md-nav__link">
      LifeOfAFeature
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Upgrading-from-Beta.10-to-Beta.12/" title="从Beta.10升级到Beta.12" class="md-nav__link">
      从Beta.10升级到Beta.12
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Upgrading-from-Beta.10-to-Beta.14/" title="从Beta.10升级到Beta.14" class="md-nav__link">
      从Beta.10升级到Beta.14
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../xi18n/" title="xi18n" class="md-nav__link">
      xi18n
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-cli-integration" title="Example CLI Integration:" class="md-nav__link">
    Example CLI Integration:
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="angular-universal-integration">Angular Universal Integration<a class="headerlink" href="#angular-universal-integration" title="Permanent link">&para;</a></h1>
<p>The Angular CLI supports generation of a Universal build for your application. This is a CommonJS-formatted bundle which can be <code>require()</code>'d into a Node application (for example, an Express server) and used with <code>@angular/platform-server</code>'s APIs to prerender your application.</p>
<hr />
<h2 id="example-cli-integration">Example CLI Integration:<a class="headerlink" href="#example-cli-integration" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/angular/universal-starter">Angular Universal-Starter</a> - Clone the universal-starter for a working example.</p>
<hr />
<h1 id="integrating-angular-universal-into-existing-cli-applications">Integrating Angular Universal into existing CLI Applications<a class="headerlink" href="#integrating-angular-universal-into-existing-cli-applications" title="Permanent link">&para;</a></h1>
<p>This story will show you how to set up Universal bundling for an existing <code>@angular/cli</code> project in 5 steps.</p>
<hr />
<h2 id="install-dependencies">Install Dependencies<a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h2>
<p>Install <code>@angular/platform-server</code> into your project. Make sure you use the same version as the other <code>@angular</code> packages in your project.</p>
<blockquote>
<p>You'll also need ts-loader (for your webpack build we'll show later) and @nguniversal/module-map-ngfactory-loader, as it's used to handle lazy-loading in the context of a server-render. (by loading the chunks right away)</p>
</blockquote>
<div class="codehilite"><pre><span></span>$ npm install --save @angular/platform-server @nguniversal/module-map-ngfactory-loader ts-loader
</pre></div>

<h2 id="step-1-prepare-your-app-for-universal-rendering">Step 1: Prepare your App for Universal rendering<a class="headerlink" href="#step-1-prepare-your-app-for-universal-rendering" title="Permanent link">&para;</a></h2>
<p>The first thing you need to do is make your <code>AppModule</code> compatible with Universal by adding <code>.withServerTransition()</code> and an application ID to your <code>BrowserModule</code> import:</p>
<h3 id="srcappappmodulets">src/app/app.module.ts:<a class="headerlink" href="#srcappappmodulets" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="c1">// Add .withServerTransition() to support Universal rendering.</span>
    <span class="c1">// The application ID can be any identifier which is unique on</span>
    <span class="c1">// the page.</span>
    <span class="nx">BrowserModule</span><span class="p">.</span><span class="nx">withServerTransition</span><span class="p">({</span><span class="nx">appId</span><span class="o">:</span> <span class="s1">&#39;my-app&#39;</span><span class="p">}),</span>
    <span class="p">...</span>
  <span class="p">],</span>

<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</pre></div>

<p>Next, create a module specifically for your application when running on the server. It's recommended to call this module <code>AppServerModule</code>.</p>
<p>This example places it alongside <code>app.module.ts</code> in a file named <code>app.server.module.ts</code>:</p>
<h3 id="srcappappservermodulets">src/app/app.server.module.ts:<a class="headerlink" href="#srcappappservermodulets" title="Permanent link">&para;</a></h3>
<p>You can see here we're simply Importing everything from AppModule, followed by ServerModule.</p>
<blockquote>
<p>One important thing to Note: We need <code>ModuleMapLoaderModule</code> to help make Lazy-loaded routes possible during Server-side renders with the Angular-CLI.</p>
</blockquote>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span><span class="nx">NgModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">ServerModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-server&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">ModuleMapLoaderModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@nguniversal/module-map-ngfactory-loader&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span><span class="nx">AppModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.module&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">AppComponent</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="c1">// The AppServerModule should import your AppModule followed</span>
    <span class="c1">// by the ServerModule from @angular/platform-server.</span>
    <span class="nx">AppModule</span><span class="p">,</span>
    <span class="nx">ServerModule</span><span class="p">,</span>
    <span class="nx">ModuleMapLoaderModule</span> <span class="c1">// &lt;-- *Important* to have lazy-loaded routes work</span>
  <span class="p">],</span>
  <span class="c1">// Since the bootstrapped component is not inherited from your</span>
  <span class="c1">// imported AppModule, it needs to be repeated here.</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppServerModule</span> <span class="p">{}</span>
</pre></div>

<hr />
<h2 id="step-2-create-a-server-main-file-and-tsconfig-to-build-it">Step 2: Create a server "main" file and tsconfig to build it<a class="headerlink" href="#step-2-create-a-server-main-file-and-tsconfig-to-build-it" title="Permanent link">&para;</a></h2>
<p>Create a main file for your Universal bundle. This file only needs to export your <code>AppServerModule</code>. It can go in <code>src</code>. This example calls this file <code>main.server.ts</code>:</p>
<h3 id="srcmainserverts">src/main.server.ts:<a class="headerlink" href="#srcmainserverts" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="kr">export</span> <span class="p">{</span> <span class="nx">AppServerModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app/app.server.module&#39;</span><span class="p">;</span>
</pre></div>

<p>Copy <code>tsconfig.app.json</code> to <code>tsconfig.server.json</code> and change it to build with a <code>"module"</code> target of <code>"commonjs"</code>.</p>
<p>Add a section for <code>"angularCompilerOptions"</code> and set <code>"entryModule"</code> to your <code>AppServerModule</code>, specified as a path to the import with a hash (<code>#</code>) containing the symbol name. In this example, this would be <code>app/app.server.module#AppServerModule</code>.</p>
<h3 id="srctsconfigserverjson">src/tsconfig.server.json:<a class="headerlink" href="#srctsconfigserverjson" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;extends&quot;</span><span class="o">:</span> <span class="s2">&quot;../tsconfig.json&quot;</span><span class="p">,</span>
  <span class="s2">&quot;compilerOptions&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;outDir&quot;</span><span class="o">:</span> <span class="s2">&quot;../out-tsc/app&quot;</span><span class="p">,</span>
    <span class="s2">&quot;baseUrl&quot;</span><span class="o">:</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="c1">// Set the module format to &quot;commonjs&quot;:</span>
    <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;commonjs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;types&quot;</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">},</span>
  <span class="s2">&quot;exclude&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;test.ts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;**/*.spec.ts&quot;</span>
  <span class="p">],</span>
  <span class="c1">// Add &quot;angularCompilerOptions&quot; with the AppServerModule you wrote</span>
  <span class="c1">// set as the &quot;entryModule&quot;.</span>
  <span class="s2">&quot;angularCompilerOptions&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;entryModule&quot;</span><span class="o">:</span> <span class="s2">&quot;app/app.server.module#AppServerModule&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<hr />
<h2 id="step-3-create-a-new-project-in-angular-clijson">Step 3: Create a new project in <code>.angular-cli.json</code><a class="headerlink" href="#step-3-create-a-new-project-in-angular-clijson" title="Permanent link">&para;</a></h2>
<p>In <code>.angular-cli.json</code> there is an array under the key <code>"apps"</code>. Copy the configuration for your client application there, and paste it as a new entry in the array, with an additional key <code>"platform"</code> set to <code>"server"</code>.</p>
<p>Then, remove the <code>"polyfills"</code> key - those aren't needed on the server, and adjust <code>"main"</code>, and <code>"tsconfig"</code> to point to the files you wrote in step 2. Finally, adjust <code>"outDir"</code> to a new location (this example uses <code>dist-server</code>).</p>
<h3 id="angular-clijson">.angular-cli.json:<a class="headerlink" href="#angular-clijson" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="p">...</span>
  <span class="s2">&quot;apps&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="c1">// Keep your original application config intact here, this is app 0</span>
      <span class="c1">// -EXCEPT- for outDir, update it to dist/browser</span>
      <span class="s2">&quot;outDir&quot;</span><span class="o">:</span> <span class="s2">&quot;dist/browser&quot;</span> <span class="c1">// &lt;-- update this</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="c1">// This is your server app. It is app 1.</span>
      <span class="s2">&quot;platform&quot;</span><span class="o">:</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span>
      <span class="s2">&quot;root&quot;</span><span class="o">:</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span>
      <span class="c1">// Build to dist/server instead of dist. This prevents</span>
      <span class="c1">// client and server builds from overwriting each other.</span>
      <span class="s2">&quot;outDir&quot;</span><span class="o">:</span> <span class="s2">&quot;dist/server&quot;</span><span class="p">,</span>
      <span class="s2">&quot;assets&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;assets&quot;</span><span class="p">,</span>
        <span class="s2">&quot;favicon.ico&quot;</span>
      <span class="p">],</span>
      <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span>
      <span class="c1">// Change the main file to point to your server main.</span>
      <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="s2">&quot;main.server.ts&quot;</span><span class="p">,</span>
      <span class="c1">// Remove polyfills.</span>
      <span class="c1">// &quot;polyfills&quot;: &quot;polyfills.ts&quot;,</span>
      <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;test.ts&quot;</span><span class="p">,</span>
      <span class="c1">// Change the tsconfig to point to your server config.</span>
      <span class="s2">&quot;tsconfig&quot;</span><span class="o">:</span> <span class="s2">&quot;tsconfig.server.json&quot;</span><span class="p">,</span>
      <span class="s2">&quot;testTsconfig&quot;</span><span class="o">:</span> <span class="s2">&quot;tsconfig.spec.json&quot;</span><span class="p">,</span>
      <span class="s2">&quot;prefix&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
      <span class="s2">&quot;styles&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;styles.css&quot;</span>
      <span class="p">],</span>
      <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;environmentSource&quot;</span><span class="o">:</span> <span class="s2">&quot;environments/environment.ts&quot;</span><span class="p">,</span>
      <span class="s2">&quot;environments&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;dev&quot;</span><span class="o">:</span> <span class="s2">&quot;environments/environment.ts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prod&quot;</span><span class="o">:</span> <span class="s2">&quot;environments/environment.prod.ts&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>

<h2 id="building-the-bundle">Building the bundle<a class="headerlink" href="#building-the-bundle" title="Permanent link">&para;</a></h2>
<p>With these steps complete, you should be able to build a server bundle for your application, using the <code>--app</code> flag to tell the CLI to build the server bundle, referencing its index of <code>1</code> in the <code>"apps"</code> array in <code>.angular-cli.json</code>:</p>
<div class="codehilite"><pre><span></span><span class="c1"># This builds the client application in dist/browser/</span>
$ ng build --prod
...
<span class="c1"># This builds the server bundle in dist/server/</span>
$ ng build --prod --app <span class="m">1</span> --output-hashing<span class="o">=</span><span class="nb">false</span>

<span class="c1"># outputs:</span>
Date: <span class="m">2017</span>-07-24T22:42:09.739Z
Hash: 9cac7d8e9434007fd8da
Time: 4933ms
chunk <span class="o">{</span><span class="m">0</span><span class="o">}</span> main.js <span class="o">(</span>main<span class="o">)</span> <span class="m">9</span>.49 kB <span class="o">[</span>entry<span class="o">]</span> <span class="o">[</span>rendered<span class="o">]</span>
chunk <span class="o">{</span><span class="m">1</span><span class="o">}</span> styles.css <span class="o">(</span>styles<span class="o">)</span> <span class="m">0</span> bytes <span class="o">[</span>entry<span class="o">]</span> <span class="o">[</span>rendered<span class="o">]</span>
</pre></div>

<hr />
<h2 id="step-4-setting-up-an-express-server-to-run-our-universal-bundles">Step 4: Setting up an Express Server to run our Universal bundles<a class="headerlink" href="#step-4-setting-up-an-express-server-to-run-our-universal-bundles" title="Permanent link">&para;</a></h2>
<p>Now that we have everything set up to -make- the bundles, how we get everything running?</p>
<p>PlatformServer offers a method called <code>renderModuleFactory()</code> that we can use to pass in our AoT'd AppServerModule, to serialize our application, and then we'll be returning that result to the Browser.</p>
<div class="codehilite"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">renderModuleFactory</span><span class="p">(</span><span class="nx">AppServerModuleNgFactory</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// Our index.html</span>
    <span class="nb">document</span><span class="o">:</span> <span class="nx">template</span><span class="p">,</span>
    <span class="nx">url</span>: <span class="kt">options.req.url</span><span class="p">,</span>
    <span class="c1">// DI so that we can get lazy-loading to work differently (since we need it to just instantly render it)</span>
    <span class="nx">extraProviders</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">provideModuleMap</span><span class="p">(</span><span class="nx">LAZY_MODULE_MAP</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">html</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>You could do this, if you want complete flexibility, or use an express-engine with a few other built in features from <a href="https://github.com/angular/universal/tree/master/modules/express-engine"><code>@nguniversal/express-engine</code></a> found here.</p>
<div class="codehilite"><pre><span></span><span class="c1">// It&#39;s used as easily as</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ngExpressEngine</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@nguniversal/express-engine&#39;</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="nx">ngExpressEngine</span><span class="p">({</span>
  <span class="nx">bootstrap</span>: <span class="kt">AppServerModuleNgFactory</span><span class="p">,</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">provideModuleMap</span><span class="p">(</span><span class="nx">LAZY_MODULE_MAP</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">}));</span>
</pre></div>

<p>Below we can see a TypeScript implementation of a -very- simple Express server to fire everything up.</p>
<blockquote>
<p>Note: This is a very bare bones Express application, and is just for demonstrations sake. In a real production environment, you'd want to make sure you have other authentication and security things setup here as well. This is just meant just to show the specific things needed that are relevant to Universal itself. The rest is up to you!</p>
</blockquote>
<p>At the ROOT level of your project (where package.json / etc are), created a file named: <strong><code>server.ts</code></strong></p>
<h3 id="serverts-root-project-level">./server.ts (root project level)<a class="headerlink" href="#serverts-root-project-level" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1">// These are important and needed before anything else</span>
<span class="kr">import</span> <span class="s1">&#39;zone.js/dist/zone-node&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s1">&#39;reflect-metadata&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span> <span class="nx">renderModuleFactory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-server&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">enableProdMode</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">express</span> <span class="nx">from</span> <span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">join</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">readFileSync</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>

<span class="c1">// Faster server renders w/ Prod mode (dev mode never needed)</span>
<span class="nx">enableProdMode</span><span class="p">();</span>

<span class="c1">// Express server</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">4000</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">DIST_FOLDER</span> <span class="o">=</span> <span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">);</span>

<span class="c1">// Our index.html we&#39;ll use as our template</span>
<span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">join</span><span class="p">(</span><span class="nx">DIST_FOLDER</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)).</span><span class="nx">toString</span><span class="p">();</span>

<span class="c1">// * NOTE :: leave this as require() since this file is built Dynamically from webpack</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">AppServerModuleNgFactory</span><span class="p">,</span> <span class="nx">LAZY_MODULE_MAP</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./dist/server/main.bundle&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">provideModuleMap</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@nguniversal/module-map-ngfactory-loader&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">renderModuleFactory</span><span class="p">(</span><span class="nx">AppServerModuleNgFactory</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// Our index.html</span>
    <span class="nb">document</span><span class="o">:</span> <span class="nx">template</span><span class="p">,</span>
    <span class="nx">url</span>: <span class="kt">options.req.url</span><span class="p">,</span>
    <span class="c1">// DI so that we can get lazy-loading to work differently (since we need it to just instantly render it)</span>
    <span class="nx">extraProviders</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">provideModuleMap</span><span class="p">(</span><span class="nx">LAZY_MODULE_MAP</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">html</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">join</span><span class="p">(</span><span class="nx">DIST_FOLDER</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">));</span>

<span class="c1">// Server static files from /browser</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*.*&#39;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">join</span><span class="p">(</span><span class="nx">DIST_FOLDER</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">)));</span>

<span class="c1">// All regular routes use the Universal engine</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">join</span><span class="p">(</span><span class="nx">DIST_FOLDER</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">),</span> <span class="p">{</span> <span class="nx">req</span> <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Start up the Node server</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Node server listening on http://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h2 id="step-5-setup-a-webpack-config-to-handle-this-node-serverts-file-and-serve-your-application">Step 5: Setup a webpack config to handle this Node server.ts file and serve your application!<a class="headerlink" href="#step-5-setup-a-webpack-config-to-handle-this-node-serverts-file-and-serve-your-application" title="Permanent link">&para;</a></h2>
<p>Now that we have our Node Express server setup, we need to pack it and serve it!</p>
<p>Create a file named <code>webpack.server.config.js</code> at the ROOT of your application.</p>
<blockquote>
<p>This file basically takes that server.ts file, and takes it and compiles it and every dependency it has into <code>dist/server.js</code>.</p>
</blockquote>
<h3 id="webpackserverconfigjs-root-project-level">./webpack.server.config.js (root project level)<a class="headerlink" href="#webpackserverconfigjs-root-project-level" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack&#39;</span><span class="p">);</span>

<span class="kr">module</span><span class="nx">.exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>  <span class="nx">server</span><span class="o">:</span> <span class="s1">&#39;./server.ts&#39;</span> <span class="p">},</span>
  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span> <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.ts&#39;</span><span class="p">]</span> <span class="p">},</span>
  <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
  <span class="c1">// this makes sure we include node_modules and other 3rd party libraries</span>
  <span class="nx">externals</span><span class="o">:</span> <span class="p">[</span><span class="sr">/(node_modules|main\..*\.js)/</span><span class="p">],</span>
  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">path</span>: <span class="kt">path.join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].js&#39;</span>
  <span class="p">},</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.ts$/</span><span class="p">,</span> <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;ts-loader&#39;</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="c1">// Temporary Fix for issue: https://github.com/angular/angular/issues/11580</span>
    <span class="c1">// for &quot;WARNING Critical dependency: the request of a dependency is an expression&quot;</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">ContextReplacementPlugin</span><span class="p">(</span>
      <span class="sr">/(.+)?angular(\\|\/)core(.+)?/</span><span class="p">,</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">),</span> <span class="c1">// location of your src</span>
      <span class="p">{}</span> <span class="c1">// a map of your routes</span>
    <span class="p">),</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">ContextReplacementPlugin</span><span class="p">(</span>
      <span class="sr">/(.+)?express(\\|\/)(.+)?/</span><span class="p">,</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">),</span>
      <span class="p">{}</span>
    <span class="p">)</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p><strong>Almost there!</strong></p>
<p>Now let's see what our resulting structure should look like, if we open up our <code>/dist/</code> folder we should see:</p>
<div class="codehilite"><pre><span></span>/dist/
   /browser/
   /server/
</pre></div>

<p>To fire up the application, in your terminal enter</p>
<div class="codehilite"><pre><span></span>node dist/server.js
</pre></div>

<p>:sparkles:</p>
<p>Now lets create a few handy scripts to help us do all of this in the future.</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="err">:</span> <span class="p">{</span>

  <span class="err">//</span> <span class="err">These</span> <span class="err">will</span> <span class="err">be</span> <span class="err">your</span> <span class="err">common</span> <span class="err">scripts</span>
  <span class="nt">&quot;build:ssr&quot;</span><span class="p">:</span> <span class="s2">&quot;npm run build:client-and-server-bundles &amp;&amp; npm run webpack:server&quot;</span><span class="p">,</span>
  <span class="nt">&quot;serve:ssr&quot;</span><span class="p">:</span> <span class="s2">&quot;node dist/server.js&quot;</span><span class="p">,</span>

  <span class="err">//</span> <span class="err">Helpers</span> <span class="err">for</span> <span class="err">the</span> <span class="err">above</span> <span class="err">scripts</span>
  <span class="nt">&quot;build:client-and-server-bundles&quot;</span><span class="p">:</span> <span class="s2">&quot;ng build --prod &amp;&amp; ng build --prod --app 1 --output-hashing=false&quot;</span><span class="p">,</span>
  <span class="nt">&quot;webpack:server&quot;</span><span class="p">:</span> <span class="s2">&quot;webpack --config webpack.server.config.js --progress --colors&quot;</span>
<span class="p">}</span>
</pre></div>

<p>In the future when you want to see a Production build of your app with Universal (locally), you can simply run:</p>
<div class="codehilite"><pre><span></span>npm run build:ssr <span class="o">&amp;&amp;</span> npm run serve:ssr
</pre></div>

<p>Enjoy!</p>
<p>Once again to see a working version of everything, check out the <a href="https://github.com/angular/universal-starter">universal-starter</a>.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../github-pages/" title="github页面" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                github页面
              </span>
            </div>
          </a>
        
        
          <a href="../multiple-apps/" title="多应用" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                多应用
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            版权 &copy; 2018 wohugb.github.io
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.8eb9be28.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>